<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Szczeg√≥≈Çy posta</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="navbar">
    <a href="index.html" class="logo">BlogApp ‚ú®</a>
    <div class="nav-links">
        <a href="index.html">‚Üê Wr√≥ƒá</a>
    </div>
</nav>

<div class="container">
    <div class="post-detail-container">
        <div class="detail-header">
            <h1 id="title">≈Åadowanie...</h1>
            <div class="detail-meta">
                Autor: <span id="author" class="author-badge">-</span> ‚Ä¢
                <span id="date">-</span>
            </div>
        </div>

        <div id="content" class="detail-content">
            ≈Åadowanie tre≈õci...
        </div>

        <div class="comments-section">
            <h3 style="margin-bottom: 20px;">üí¨ Komentarze</h3>

            <div class="form-group">
                <textarea id="commentContent" rows="3" placeholder="Napisz komentarz..."></textarea>
            </div>
            <div class="form-group" style="display: flex; gap: 10px;">
                <input type="text" id="commentAuthor" placeholder="Twoje imiƒô (opcjonalne)">
                <button onclick="addComment()">Wy≈õlij</button>
            </div>

            <div id="commentsList"></div>
        </div>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');

    async function loadPost() {
        if (!postId) return;
        try {
            const res = await fetch(`http://localhost:3000/api/posts/${postId}`);
            const post = await res.json();

            document.getElementById('title').textContent = post.title;
            document.getElementById('content').textContent = post.content;
            document.getElementById('author').textContent = post.author_name || 'Anonim';
            document.getElementById('date').textContent = new Date(post.created_at).toLocaleDateString('pl-PL');

            loadComments();
        } catch (err) {
            document.getElementById('title').textContent = 'B≈ÇƒÖd';
            document.getElementById('content').textContent = 'Nie znaleziono posta.';
        }
    }

    async function loadComments() {
        try {
            const res = await fetch(`http://localhost:3000/api/comments/post/${postId}`);
            const comments = await res.json();
            const list = document.getElementById('commentsList');
            list.innerHTML = '';

            comments.forEach(c => {
                const div = document.createElement('div');
                div.className = 'comment';
                div.innerHTML = `
                        <div class="comment-header">
                            <span class="comment-author">${c.author_name || 'Go≈õƒá'}</span>
                            <span>${new Date(c.created_at).toLocaleDateString()}</span>
                        </div>
                        <div>${c.content}</div>
                    `;
                list.appendChild(div);
            });
        } catch (e) { console.error(e); }
    }

    async function addComment() {
        const content = document.getElementById('commentContent').value;
        const author = document.getElementById('commentAuthor').value; // Tymczasowo, p√≥≈∫niej we≈∫miemy z logowania

        if(!content) return alert("Wpisz tre≈õƒá!");

        await fetch('http://localhost:3000/api/comments', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content, postId, authorId: null }) // authorId null bo nie mamy jeszcze logowania
        });

        document.getElementById('commentContent').value = '';
        loadComments();
    }

    loadPost();
</script>
</body>
</html>